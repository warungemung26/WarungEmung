<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warung Emung Praktis, Hemat, Dekat</title>
  <!-- ================== CSS ================== -->
  <!-- 1Ô∏è‚É£ Urutan: paling umum ‚Üí spesifik -->
  <!-- ================== CSS ================== -->
  <link rel="stylesheet" href="css/ui.css">
<link rel="stylesheet" href="css/popup-reg.css">
<link rel="stylesheet" href="css/qty-addcart.css">
<link rel="stylesheet" href="css/cart-modal.css">
<link rel="stylesheet" href="css/cat-modal.css">
<link rel="stylesheet" href="css/akun-modal.css">
<link rel="stylesheet" href="css/nama-alamat.css">
<link rel="stylesheet" href="css/toast.css">
<link rel="stylesheet" href="css/text-scrol.css">
<link rel="stylesheet" href="css/search.css">


  <!-- ================== PWA META ================== -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f6b042">

<script>
// ================= UNREGISTER LAMA SW =================
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(reg => {
      reg.unregister().then(() => {
        console.log('‚úÖ SW lama dihapus:', reg.scope);
      });
    });
  });
}
</script>
	
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PYZMBZNKER"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PYZMBZNKER');
</script>

</head>
<body>
	<section id="home"><h2></h2>
<!-- ================= HEADER ================= -->
<header class="header">
  <div class="header-left">
    <img src="images/logo-warung.png" alt="Logo Warung Emung" class="logo">
    <div class="header-text">
      <h1>Warung Emung</h1>
      <p class="lead">Praktis, Hemat, Dekat<br>Gg. Subur Blok. Wanakaya RT01/RW02 No.26</p>
    </div>
  </div>
  <div class="header-right">
    <!-- Tombol Help -->
  <a href="pages/help-center.html" 
     style="display:inline-flex;align-items:center;gap:6px;padding:8px 12px;background:#f6b042;color:#fff;border-radius:12px;text-decoration:none;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,0.1);transition:0.2s;">
    <i class="fa fa-circle-question"></i> Bantuan
  </a>
</div
  </div>
</header>

  <!-- ================= SEARCH ================= -->
<div style="display:flex;gap:6px;margin:16px 0">
  <input id="search" placeholder="üîéCari produk... (misal: mie)" style="flex:1;padding:10px;border-radius:8px;border:1px solid #ddd" />
  <button id="search-btn" style="padding:10px 16px;border:none;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer">üîç</button>
</div>


<!-- PENGUMUMAN BERJALAN -->
<div class="pengumuman">
  <marquee behavior="scroll" direction="left">
    ‚ö†Ô∏è PERHATIAN: Saat ini semua stok belum tersedia ‚Äî website masih dalam pengembangan ‚ö†Ô∏è
  </marquee>
</div>

<!-- ================= HERO ================= -->
<section class="hero">
  <h2 style="margin:0 0 8px">Belanja Harian Lebih Mudah</h2>
  <p style="margin:0 0 12px; color:#fff">
    Belanja harian gampang, tinggal klik ‚Äî langsung kami antar! Buka setiap hari 06.00-22.00
  </p>

  <!-- Tombol Request Stok Modern -->
<div class="hero-cta">
  <a class="cta-link wa-hero" 
     href="https://wa.me/6285322882512?text=Halo%20Warung%20Emung,%20saya%20ingin%20request%20produk:%20[NAMA%20PRODUK]%20dengan%20jumlah:%20[JUMLAH]%20Mohon%20informasinya."
     id="wa-hero-cta">
     <i class="fa-brands fa-whatsapp"></i>
     <span>Request Stok Sekarang</span>
  </a>

  <p class="wa-cta-instructions">
    Ganti <strong>[NAMA PRODUK]</strong> &amp; <strong>[JUMLAH]</strong> di form setelah tekan.
  </p>
</div>
</section>

<!-- REGISTER POPUP -->
<div id="register-backdrop" class="modal-backdrop" style="display:none;">
  <div id="register-modal" class="reg-modal-box">

    <!-- STEP 1: PILIHAN AWAL -->
    <div id="reg-step1" class="reg-step active">
      <h3>Selamat Datang!</h3>
      <p>Daftar untuk menjadi pelanggan Warung Emung.</p>

      <div class="reg-actions reg-actions-bottom">
        <button id="btn-register-now" class="primary big-btn">Daftar Sekarang</button>
        <button id="btn-register-later" class="secondary big-btn">Daftar Nanti</button>
      </div>
    </div>

    <!-- STEP 2: FORM PENDAFTARAN -->
    <div id="reg-step2" class="reg-step">
      <h3>Daftar Pelanggan</h3>
      <p>Data disimpan di perangkat Anda.</p>

      <!-- AREA SCROLL -->
      <div class="reg-scroll-area">

        <div class="reg-form">
          <label>Nama Lengkap:</label>
          <input type="text" id="reg-nama" placeholder="Contoh: Budi Setiawan">

          <label>Alamat:</label>
          <input type="text" id="reg-alamat" value="Blok Wanakaya" readonly>

          <label>Nomor Rumah:</label>
          <input type="number" id="reg-no" placeholder="17" min="1" max="999">

          <label>RT / RW:</label>
          <select id="reg-rtrw">
          <option value="">Pilih RT / RW</option>
          <option value="01/01">01/01</option>
          <option value="01/02">01/02</option>
          <option value="01/03">01/03</option>
          <option value="02/01">02/01</option>
          <option value="02/02">02/02</option>
          <option value="02/03">02/03</option>
        </select>

          <label>Nomor HP (opsional):</label>
          <input type="text" id="reg-hp" placeholder="08123xxxxxxx">
        </div>

      </div>

      <!-- TOMBOL BAWAH -->
      <div class="reg-actions reg-actions-bottom">
        <button id="btn-back-register" class="secondary">Kembali</button>
        <button id="btn-save-register" class="primary">Simpan Data</button>
      </div>

      <small id="register-hint"></small>
    </div>

  </div>
</div>


<!-- ACCOUNT MODAL -->
<div id="account-backdrop" class="modal-backdrop">
  <div id="account-modal" class="modal-box">
    <h3>Akun Saya</h3>

    <!-- TAB -->
    <div class="acc-tabs">
      <button class="tab-btn active" data-tab="tab-profil">Profil</button>
      <button class="tab-btn" data-tab="tab-riwayat">Riwayat</button>
    </div>

    <!-- AREA SCROLL -->
    <div class="acc-scroll-area">

      <!-- === TAB PROFIL === -->
      <div class="tab-content active" id="tab-profil">
        <div class="pp-box">
          <img id="pp-preview" src="img/default-pp.png" alt="Foto Profil">
          <button id="btn-ubah-pp">Ubah Foto</button>
          <input type="file" id="pp-input" accept="image/*" style="display:none;">
        </div>

        <div class="acc-form">
          <label>Nama:</label>
          <input type="text" id="acc-nama">
          <label>Alamat:</label>
          <input type="text" id="acc-alamat">
          <label>Nomor Rumah:</label>
          <input type="text" id="acc-no">
          <label>RT / RW:</label>
          <input type="text" id="acc-rt">
          <label>Nomor HP (opsional):</label>
          <input type="text" id="acc-hp">
        </div>
      </div>

      <!-- === TAB RIWAYAT === -->
      <div class="tab-content" id="tab-riwayat">
        <div id="riwayat-list"></div>
      </div>

    </div>

    <!-- TOMBOL BAWAH FIX -->
    <div class="acc-actions acc-actions-bottom">
      <button id="acc-close-btn" class="secondary">Tutup</button>
      <button id="acc-save-btn" class="primary">Simpan Perubahan</button>
    </div>

  </div>
</div>


<button onclick="localStorage.clear(); alert('CLEARED');">
  Hapus Riwayat Akun
</button>


<button id="open-cart" class="cart-btn" title="Keranjang"><span id="cart-count" class="cart-count" style="display:none">0</span></button>
      
<!-- ================= MENU KATEGORI ================= -->
<h3 style="margin:10px 0;">Pilih Kategori</h3>
<div class="kategori-grid">

  <div class="cat active" onclick="setCategory('')">
    <i class="fas fa-store"></i><span>Semua</span>
  </div>

  <div class="cat" onclick="setCategory('sembako')">
    <i class="fas fa-seedling"></i><span>Sembako</span>
  </div>

  <div class="cat" onclick="setCategory('makanan')">
    <i class="fas fa-utensils"></i><span>Makanan</span>
  </div>

  <div class="cat" onclick="setCategory('mie')">
    <i class="fas fa-bowl-food"></i><span>Mie Instan</span>
  </div>

  <div class="cat" onclick="setCategory('snack')">
    <i class="fas fa-cookie-bite"></i><span>Snack</span>
  </div>

  <div class="cat" onclick="setCategory('minuman')">
    <i class="fas fa-coffee"></i><span>Minuman</span>
  </div>

  <div class="cat" onclick="setCategory('minumansachet')">
    <i class="fas fa-mug-hot"></i><span>Sachet</span>
  </div>

  <div class="cat" onclick="setCategory('rumah')">
    <i class="fas fa-broom"></i><span>Rumah</span>
  </div>
  
</div>
  
</div>
</div>

  <!-- ================= PRODUK LIST================= -->
  <h3 style="margin-top:22px">Etalase Warung</h3>
  <div id="produk-list"></div>
  
  <!-- ================= TAMPILAN CART MODAL ================= -->
  <div id="cart-modal" class="modal" role="dialog" aria-hidden="true">
    <h4>Keranjang Anda</h4>
    <div id="cart-items"></div>
    <div class="total" id="cart-total"></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="wa-cart" class="wa-btn">Pesan Semua via <i class="fa-brands fa-whatsapp"></i></button>
      <button id="clear-cart" class="add-btn" style="background:#ff4b4b;color:#fff;">Kosongkan</button>
    </div>
  </div>

  <!-- ================= FOOTER ================= -->
  <footer>Warung Emung ‚Äî Praktis, Hemat, Dekat ‚Ä¢ Hubungi via WhatsApp untuk pesanan</footer>

  <!-- ================= TOAST NOTIF ================= -->
  <div id="toast">Berhasil</div>

<!-- ================= TAMPILAN KATEGORI MODAL ================= -->
<div id="cat-modal-backdrop">
  <div id="cat-modal" role="dialog" aria-hidden="true">

    <!-- Tombol tutup -->
    <button id="close-cat" class="close-btn"><i class="fa-solid fa-xmark"></i></button>

    <!-- Judul modal -->
    <h4 style="margin-top:4px; text-align:center;">
      <i class="fa-solid fa-list"></i> Pilih Kategori
    </h4>

    <!-- Grid kategori -->
    <div id="cat-options" style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-top:10px;">

      <div class="cat" data-cat="">
        <i class="fa-solid fa-cart-shopping"></i> Semua Produk
      </div>

      <div class="cat" data-cat="sembako">
        <i class="fa-solid fa-bowl-rice"></i> Sembako
      </div>

      <div class="cat" data-cat="makanan">
        <i class="fa-solid fa-burger"></i> Makanan Cepat Saji
      </div>

      <div class="cat" data-cat="mie">
        <i class="fa-solid fa-bowl-food"></i> Mie Instan
      </div>

      <div class="cat" data-cat="snack">
        <i class="fa-solid fa-cookie-bite"></i> Snack & Ringan
      </div>

      <div class="cat" data-cat="minuman">
        <i class="fa-solid fa-bottle-water"></i> Minuman Dingin
      </div>

      <div class="cat" data-cat="minumansachet">
        <i class="fa-solid fa-mug-hot"></i> Minuman Sachet & Obat
      </div>

      <div class="cat" data-cat="rumah">
        <i class="fa-solid fa-soap"></i> Kebutuhan Rumah
      </div>

    </div>
  </div>
</div>

  </div>
</div>

<div class="bottom-nav">
  <a href="#home" id="nav-home" class="active">
    <i class="fa-solid fa-house"></i>
    <span>Beranda</span>
  </a>

  <a href="#cat" id="nav-cat">
    <i class="fa-solid fa-book"></i>
    <span>Kategori</span>
  </a>

  <a href="#search" id="nav-search">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span>Cari</span>
  </a>

<a href="#account" id="nav-account">
  <i class="fa-solid fa-user"></i>
  <span>Akun</span>
</a>

   <!-- NAVBAR: Tombol WA (icon kecil) -->
<a class="cta-link wa-nav"
   href="https://wa.me/6285322882512?text=Halo%20Warung%20Emung,%20saya%20ingin%20cek%20pesanan%20saya."
   aria-label="Hubungi via WhatsApp"
   title="Hubungi via WhatsApp">
   <i class="fa-brands fa-whatsapp"></i>
</a>

  <a href="#cart" id="nav-cart">
    <i class="fa-solid fa-cart-shopping"></i>
    <span>Troli</span>
    <div class="badge" id="cart-badge">0</div>
  </a>
</div>


<button id="installBtn" style="position:fixed;bottom:110px;right:12px;z-index:9999;display:none;border-radius:10px;padding:8px 12px;background:#f6b042;color:#fff">
  ‚ûï Instal Warung Emung
</button>

<!-- Modal Konfirmasi Global -->
<div id="modal-confirm" class="modal-confirm">
  <div class="modal-content">
    <h3 id="modal-title">Konfirmasi</h3>
    <p id="modal-message">Apakah Anda yakin ingin melanjutkan?</p>
    
    <!-- Form input WA (hanya muncul jika WA) -->
    <div id="modal-wa-inputs" style="display:none; margin-top:10px;">
      <input type="text" id="modal-produk" placeholder="Nama Produk" />
      <input type="number" id="modal-jumlah" placeholder="Jumlah" />
    </div>

    <div class="modal-buttons">
      <button id="modal-cancel" class="btn-secondary">Batal</button>
      <button id="modal-ok" class="btn-primary">Ya</button>
    </div>
  </div>
</div>


  <!-- ================== JAVASCRIPT ================== -->
  <!-- Urutan stabil: fitur utama ‚Üí tambahan ‚Üí PWA/Service Worker -->
  <script src="js/data-loader.js"></script>
  <script src="js/main.js"></script>
  <script src="js/search.js"></script>
    <script src="js/cta-links.js"></script>
   <script src="js/cat-modal.js"></script>
   <script src="js/cart-modal.js"></script>
  <script src="js/toast-audio.js"></script>
  <script src="js/register.js"></script>
  <script src="js/akun-logic.js"></script>
  <script src="js/pwa.js"></script>
  
  <!-- ================= AUTO VERSION SCRIPT ================= -->
<script>
(function(){
  const version = new Date().toISOString().slice(0,10).replace(/-/g,'');
  document.querySelectorAll('link[rel="stylesheet"]').forEach(link=>{
    const href=link.getAttribute('href');
    if(href&&!href.includes('?v=')){link.setAttribute('href',href+'?v='+version);}
  });
  document.querySelectorAll('script[src]').forEach(script=>{
    const src=script.getAttribute('src');
    if(src&&!src.includes('?v=')&&!src.includes('gtag')){script.setAttribute('src',src+'?v='+version);}
  });
})();
</script>

 <!-- Service worker harus paling akhir -->
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('‚úÖ Service Worker terdaftar:', reg.scope))
      .catch(err => console.log('‚ùå SW error:', err));
  });
}
</script>


</body>

</html>
